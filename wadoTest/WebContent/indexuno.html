<!DOCTYPE HTML>
<html>
<head>
    <!-- twitter bootstrap CSS stylesheet - included to make things pretty, not needed or used by cornerstone -->
    <script src="js/jquery.min.js"></script>
    <script src="js/cornerstone.js"></script>
    <script src="js/cornerstoneMath.min.js"></script>
    <script src="js/cornerstoneTools.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/cornerstone.min.css" rel="stylesheet">
    <script src="js/cornerstoneWebImageLoader.js"></script>
    <title>Probando Cornerstone y DCM</title>
</head>
<body>
<div class="container">

   <!-- <div class="page-header">
        <h1>Example of displaying a web image (JPEG, PNG) using Cornerstone</h1>
        <p class="lead">
            Enter a URL for a JPEG or PNG image below to view it using cornerstone
        </p>
        <p>
            This example illustrates how to use the cornerstoneWebImageLoader to get a standard web
            image (JPEG, PNG)  and display it using cornerstone.
        </p>
        <strong>If you get an HTTP error and your URL is correct, it is probably because the server is not configured to
            allow <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross Origin Requests</a>.
            Most browsers will allow you to enable cross domain requests via settings or command line switches,
            you can start chrome with the command line switch <code>--disable-web-security</code> to allow cross origin requests.
            See the  <a href="http://enable-cors.org/">Enable CORS site</a> for information about CORS.
        </strong>
        <br>
        <br>
        <strong>Use of this example require IE10+ or any other modern browser.</strong>


    </div>-->
	<br><br>
    <div class="row">
        <form class="form-horizontal">
            <div class="form-group">
                <label class="control-label col-sm-1" for="study-uid-param">StudyUID</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" id="study-uid-param" placeholder="Ingrese Study Instance UID" value="">
                </div>
                
            </div>
            <br>
            <div class="form-group">
                <label class="control-label col-sm-1" for="serie-uid-param">SeriesUID</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" id="serie-uid-param" placeholder="Ingrese Serie Instance UID" value="">
                </div>
            </div>
            <br>
            <div class="form-group">
                <label class="control-label col-sm-1" for="sop-uid-param">InstanceUID</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" id="sop-uid-param" placeholder="Ingrese SOP Instance UID" value="">
                </div>
            </div>
            <br>
            <div class="col-sm-3">
                    <button class="form-control" type="button" id="downloadAndView" class="btn btn-primary">VER IMAGEN</button>
             </div>
             &nbsp;&nbsp;&nbsp;&nbsp;
             <label id="waiting">Aguarde un momento...</label>
             <br><br><br>
        </form>
    </div>

    <div style="width:512px;height:512px;position:relative;color: white;display:inline-block;border-style:solid;border-color:black;"
         oncontextmenu="return false"
         class='disable-selection noIbar'
         unselectable='on'
         onselectstart='return false;'
         onmousedown='return false;' id="image-container">
        <div id="dicomImage" style="width:512px;height:512px;top:0px;left:0px; position:absolute"></div>
    </div>
</div>
</body>



<script>
	
	var Interval = null;
	
    $(document).ready(function() {

        cornerstoneWebImageLoader.configure({
           beforeSend: function(xhr) {
               // Add custom headers here (e.g. auth tokens)
               xhr.setRequestHeader('x-auth-token', 'my auth token');		
           }
        });
        
        var element = $('#dicomImage').get(0);
        cornerstone.enable(element);
        
        var imageIds = [
				'http://localhost:8080/wado/wado?requestType=WADO&studyUID=1&seriesUID=1&objectUID=1.3.51.0.7.1594858288.23456.19785.34618.39375.15.44370',
				'http://localhost:8080/wado/wado?requestType=WADO&studyUID=1&seriesUID=1&objectUID=1.3.51.0.7.11549846930.55462.11840.44023.29390.13860.21928'
                       ];

        var currentImageIndex = 0;
        var images = [];
        
		$.each(imageIds, function(index, id){
			cornerstone.loadImage(id).then(function(image) {
                images.push(image);
            }).fail(function(){ cornerstone.disable(element); });
		});
        
        function updateTheImage(imageIndex) {
            currentImageIndex = imageIndex;
           	cornerstone.displayImage(element, images[currentImageIndex]);
        };
        
        
        $('#dicomImage').on('mousewheel DOMMouseScroll', function (e) {
            // Firefox e.originalEvent.detail > 0 scroll back, < 0 scroll forward
            // chrome/safari e.originalEvent.wheelDelta < 0 scroll back, > 0 scroll forward
            if (e.originalEvent.wheelDelta < 0 || e.originalEvent.detail > 0) {
                if (currentImageIndex == 0) {
                    updateTheImage(1);
                }
            } else {
                if (currentImageIndex == 1) {
                    updateTheImage(0);
                }
            }
            //prevent page fom scrolling
            return false;
        });
        
        Interval = setInterval(function(){
        	if(images[0] && images[0]!=null){
        		updateTheImage(0);
        		$('label#waiting').hide();
        		clearInterval(Interval);
        }},1000);
        
        
        
        
        
        
        
        
        
        $('#downloadAndView').click(function(e) {
			
        	//var url = 'http://localhost:8080/wado/wado?requestType=WADO&studyUID=${STUDYID}&seriesUID=${SERIEID}&objectUID=${SOPID}';
        	
        	if($('input#study-uid-param').val() == '') {
        		alert('Ingrese Study Instance UID');
        		return;
        	}
        	if($('input#serie-uid-param').val() == '') {
        		alert('Ingrese Serie Instance UID');
        		return;
        	}
        	if($('input#sop-uid-param').val() == '') {
        		alert('Ingrese SOP Instance UID');
        		return;
        	}
        	
        	/*url = url.replace('${STUDYID}',$('input#study-uid-param').val())
        			 .replace('${SERIEID}',$('input#serie-uid-param').val())
        			 .replace('${SOPID}',$('input#sop-uid-param').val());*/
        	
            // image enable the dicomImage element and activate a few tools
            
           	
            
            
            
            cornerstone.loadImage(url).then(function(image) {
            	if(image && image != null){
            		cornerstone.displayImage(element, image);
                    /*cornerstoneTools.mouseInput.enable(element);
                    cornerstoneTools.mouseWheelInput.enable(element);
                    cornerstoneTools.wwwc.activate(element, 1); // ww/wc is the default tool for left mouse button
                    cornerstoneTools.pan.activate(element, 2); // pan is the default tool for middle mouse button
                    cornerstoneTools.zoom.activate(element, 4); // zoom is the default tool for right mouse button
                    cornerstoneTools.zoomWheel.activate(element); // zoom is the default tool for middle mouse wheel*/
            	
            	}
            }).fail(function(){
            	cornerstone.disable(element);
            });
        });
        
        
        
        
        
        
        
        
        
    });

</script>
</html>