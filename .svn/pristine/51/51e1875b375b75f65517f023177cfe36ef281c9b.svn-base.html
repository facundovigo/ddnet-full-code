<!DOCTYPE html>
<html>
<head>
<title>Visualizaci&oacute;n de informe</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<link rel="stylesheet" type="text/css"
	href="../css/jquery-ui-1.10.4.css" />
<link rel="stylesheet" type="text/css" href="../css/layout-default.css" />
<link rel="stylesheet" type="text/css" href="../css/main.css" />
<link rel="stylesheet" type="text/css"
	href="../css/edit-study-report.css" />
<link rel="stylesheet" type="text/css"
	href="../css/jquery.dataTables.css">

<script type="text/javascript" src="../js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="../js/jquery-ui-1.10.4.js"></script>
<script type="text/javascript" src="../js/jquery.layout-1.3.0.js"></script>
<script type="text/javascript" src="../js/jquery.dataTables.js"></script>
<script type="text/javascript" src="../js/jquery.validate.js"></script>
<script type="text/javascript" src="../js/jquery.blockUI.js"></script>
<script type="text/javascript" src="../js/purl.js"></script>

<script type="text/javascript">
			var mainLayout = null;
			var studyID = null;
			
			$(document).ready(function() {
				studyID = $.url().param('s');
				document.title += ' - Estudio: ' + studyID;
								
				mainLayout = $('body').layout({
					south__paneSelector:	".edit-study-report-layout-south",
					center__paneSelector:	".edit-study-report-layout-center",
										
					south__closable : false,
					south__resizable : false,
					south__spacing_open : 0,
					south__spacing_closed : 0
					
					,
					center__closable : false,
					center__resizable : false,
					center__spacing_open : 0,
					center__spacing_closed : 0
				});
				
				$('#view-study-report-download').button
				({
				    icons: { primary: "ui-icon-arrowreturnthick-1-s" }, text: true
				});
				$('#view-study-report-exit').button
				({
				    icons: { primary: "ui-icon-close" }, text: true
				});

				$('#view-study-report-download').click(function() {
					window.location.href = 'rest/reporting/reports/pdf/' + studyID ;
				});
				
				$('#view-study-report-exit').click(function() {
					if (window.parent.closeModalDialog)
						window.parent.closeModalDialog();					
				});				
								
				populateReportBody();
			});
						
			function populateReportBody() {
				$('#report-body-editor').val('');
				$.get("rest/studies/" + studyID + '/report/body')
				  .done(function(info) {
					  $('#report-body-editor').val(info);
				  })
				  .fail(function() {
				    alert('Ocurrió un error en la comunicación con el servidor. ' + 
				    	'Por favor, reintente la operación realizada.');
					if (window.parent.closeModalDialog)
						window.parent.closeModalDialog();
				  });
			}
		</script>
</head>
<body>
	<div class="edit-study-report-layout-center">
		<textarea id="report-body-editor" name="report-body"
			readonly="readonly">
			</textarea>
	</div>
	<div class="edit-study-report-layout-south">
		<button type="button" id="view-study-report-download"
			class="edit-study-report-action-button">Descargar</button>
		<button type="button" id="view-study-report-exit"
			class="edit-study-report-action-button">Salir</button>
	</div>
</body>
</html>
