<!DOCTYPE html>
<html>
	<head>
		<title>Diagn&oacute;stico Digital - DDWEB - Administrador de estudios</title>
		
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
		<meta http-equiv="pragma" content="no-cache" />
		
		<link rel="stylesheet" type="text/css" href="../css/jquery-ui-1.10.4.css" />
		<link rel="stylesheet" type="text/css" href="../css/jquery.dataTables.css" />
		<link rel="stylesheet" type="text/css" href="../css/dataTables.tableTools.css" />		
		<link rel="stylesheet" type="text/css" href="../css/dataTables.colVis.css" />
		<link rel="stylesheet" type="text/css" href="../css/ABMestilos.css" />
		
		<script type="text/javascript" src="../js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="../js/jquery-ui-1.10.4.js"></script>
		<script type="text/javascript" src="../js/jquery.dataTables.js"></script>
		<script type="text/javascript" src="../js/dataTables.tableTools.js"></script>		
		<script type="text/javascript" src="../js/TableTools.ShowSelectedOnly.js"></script>	
		<script type="text/javascript" src="../js/dataTables.colVis.js"></script>
		<script type="text/javascript" src="../js/jquery.validate.js"></script>
		<script type="text/javascript" src="../js/jquery.blockUI.js"></script>
		<script type="text/javascript" src="../js/ABMscript.js"></script>
		
</head>
<body style="background-color: #dee1cd;">
	
	<div class="divInfo">
		<label>Diagn&oacute;stico Digital - DDWEB - ABM</label>&nbsp;&nbsp;|&nbsp;
		<label id="userinfo"></label>&nbsp;&nbsp;|&nbsp; 
		<a href="study-manager.html" target="_self">Pantalla Principal</a>&nbsp;&nbsp;&nbsp;|&nbsp;
		<a href="../manual.pdf" target="_blank">Ayuda</a>&nbsp;&nbsp;|&nbsp;
		<a href="../authentication-servlet/logout">Cerrar sesi&oacute;n</a> 
	</div>
	
	<div id="tabs">
	
		<ul>
    	<li><a href="#tabUsuarios">USUARIOS</a></li>
    	<li><a href="#tabEstudios">ESTUDIOS</a></li>
  		</ul>
  		
  		<div id="tabUsuarios">
  			
  			<table id="tbUsuarios" class="display"></table>
  			
  			<div class="userButtons">
  			<button id="btnNewUser"></button>&nbsp;&nbsp;&nbsp;&nbsp;
  			<button id="btnNewInstitution"></button>&nbsp;&nbsp;&nbsp;&nbsp;
  			<button id="btnAssignInstitution"></button>
  			</div>
  			
  		</div>
  		
  		<div id="tabEstudios" class="display">
  		
  			<div style="width:250px;border-right:dotted 1px #aaa;">
  				<label style="display:inline-block;width:80px;text-align:right;">Paciente :</label>
  				<input type="text" id="patName" style="text-align:center;font-style:italic;width:120px;" /> <br><br>
  				<label style="display:inline-block;width:80px;text-align:right;">Fecha :</label>
  				<input type="text" id="studyDate" style="text-align:center;font-style:italic;width:120px;" /> <br><br>
  				<label style="display:inline-block;width:80px;text-align:right;">Acc.Number :</label>
  				<input type="text" id="studyAccNumber" style="text-align:center;font-style:italic;width:120px;" /> <br><br>
  				<label style="display:inline-block;width:80px;text-align:right;">Modalidad :</label>
  				<input type="text" id="studyModality" style="text-align:center;font-style:italic;width:120px;" /> <br><br>
  				<button id="lookForStudies"></button>
  			</div>
  			<div style="position:absolute;top:50px;left:280px;height:70%;width:auto;">
  			<table id="studiesFounded"></table>
  			</div>
  		</div>
	
	</div>
	
	<script type="text/javascript">
		$(document).ready(function(){
			
			var dayNames = ["Domingo", "Lunes", "Martes", "Mi&eacute;rcoles", 
							"Jueves", "Viernes", "S&aacute;bado"]; 
			var dayNamesMin = ["DOM", "LUN", "MAR", "MIE", "JUE", "VIE", "SAB"];
			var monthNames = ["Enero", "Febrero", "Marzo", "Abril", 
			                  "Mayo", "Junio", "Julio", "Agosto",
			                  "Setiembre", "Octubre", "Noviembre", "Diciembre"];
			$("input#studyDate").datepicker({ dateFormat: "dd/mm/yy", 
				changeYear: true, yearRange: "-100:+0", changeMonth: true,
				dayNames: dayNames, dayNamesMin: dayNamesMin, monthNames: monthNames });
			
			$('button#lookForStudies').button({label:'Buscar'})
			.on('click',function(){
				
				if(!$('input#studyDate').val()){
					alert('ingrese fecha de estudio');
					return;
				}
				
				var queryParameters= 'study-date-between-from='+$('input#studyDate').val();
				queryParameters+= '&study-date-between-to='+$('input#studyDate').val();
				queryParameters+= '&patient-data-name='+$('input#patName').val();
				queryParameters+= '&study-accessionnumber='+$('input#studyAccNumber').val();
				queryParameters+= '&study-modality='+$('input#studyModality').val();
				
				 $.getJSON('rest/studies?' + queryParameters)
				  .done(function(result) {
					  	var dt = $('table#studiesFounded').dataTable();
					  	dt.fnClearTable();
					  	if (result && result.length > 0){
					  		dt.fnAddData(result);
					  	}
				  })
				  .fail(function() {
				    	alert('Ocurrió un error con su consulta de estudios. ' + 
				    		'Por favor, reintente la operación realizada.');
				  });	
			});
			
			var columnas = [{ 	"title": "Fecha", "data": "date", "defaultContent": "", "class": "center", "width": "90px" },
							{ 	"title": "Nombre", "data": "pn", "defaultContent": "", "class": "left", "width": "150px" },
							{ 	"title": "AccessionNumber", "data": "an", "defaultContent": "", "class": "left", "width": "120px" },
							{ 	"title": "Mod.", "data": "mod", "defaultContent": "", "class": "left", "width": "70px" },
							{	'title': 'Informado', 'data': 'rs', 'defaultcontent': '0', 'class': 'center', 'width': '90px'}
	  		];
			var columnasDef= [
				{	"targets": 4,
 					"render": function ( data, type, row ) {
 						return data==2? '<div align="center"><span class="ui-icon ui-icon-check" studyid="'+row.id+'" ondblclick="clear_report(this);"></span></div>' :
 										'<div align="center"><span class="ui-icon ui-icon-close"></span></div>' ;
 					}
				}
			];

			var dt= $('table#studiesFounded').dataTable({
				"data": [],
				"lengthMenu": [5,10,15],
				"pageLength": 5,
				"dom": 'rtlp',
				"tableTools": {
					"sRowSelect": "none",
					"aButtons": [],
					fnRowSelected: function(o) {},
					fnRowDeselected: function(o) {}
				},
				"columns": columnas,					
				"columnDefs": columnasDef,
				"language": {
				    "lengthMenu": "Mostrar _MENU_ estudios por página",
				    "zeroRecords": "No se encontraron estudios para mostrar con los criterios especificados.",
				    "info": "Mostrando página _PAGE_ de _PAGES_",
				    "infoEmpty": "Sin estudios para mostrar",
				    "infoFiltered": "(filtrados de un total de _MAX_ estudios)",
				    "emptyTable":     "Sin estudios para mostrar",
				    "infoPostFix":    "",
				    "thousands":      ".",
				    "loadingRecords": "Cargando...",
				    "processing":     "Procesando...",
				    "search":         "Buscar:",
				    "paginate": {
				        "first":      "Primera",
				        "last":       "Última",
				        "next":       "Siguiente",
				        "previous":   "Anterior"
				    },
				    "aria": {
				        "sortAscending":  ": Click para ordenar ascendentemente",
				        "sortDescending": ": Click para ordenar descendentemente"
				    }
				}});
		});
		function clear_report(elem){
			var studyId= $(elem).attr('studyid');
			
			$.post('rest/studies/clear-report/'+studyId)
			.done(function(){
				alert('Informe abierto');
				location.reload();
			})
			.fail(function(){
				alert('No se pudo abrir el Informe');
			});
		}
	</script>
	
	<!--
	<div id="dynamicModalDialog">
		<iframe id="dynamicModalDialogIframe" src=""></iframe>
	</div>-->
	
</body>
</html>