<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<script type="text/javascript" src="../js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="../js/jquery-ui.js"></script>
<script type="text/javascript" src="../js/jquery.validate.js"></script>
<script type="text/javascript" src="../js/purl.js"></script>
<link rel="stylesheet" type="text/css" href="../css/jquery-ui.css" />

<script type="text/javascript">
	$(document).ready(function(){
		$('button#saveConfiguration').button({label:'Guardar',icons:{primary:'ui-icon-disk'}}).on('click',save_configuration);
		$('button#cancelChanges').button({label:'Cancelar',icons:{primary:'ui-icon-close'}}).on('click',cancel_edition);
		$.getJSON("rest/user/info/properties")
	  	.done(function(info) {
		  	if(info&&info!=null){
		  		var input = $('input');
		  		$(input[1]).val(info.port);
		  		$(input[2]).val(info.aet);
		  		$(input[3]).val(info.callingAet);
		  	}
	  	}).fail(function() {
		  	window.parent.$alert('Ha ocurrido un error al obtener los datos.\nPor favor, reintente la operación más tarde.');
	    	cancel_edition();
		});
	});
	function save_configuration(){
		if(isClear()){$('span#warningMessage').show();return}
		$('span#warningMessage').hide();
		var input = $('input');
		var userProp = {
			hostname:$(input[0]).val(),
			port:$(input[1]).val(),
			aet:$(input[2]).val(),
			callingAet:$(input[3]).val()
		};
		$.post('rest/user/info/properties','host='+$(input[0]).val()+'&port='+$(input[1]).val()+'&aet='+$(input[2]).val()+'&caet='+$(input[3]).val())
		.done(function(){window.parent.update_configuration_tip(userProp);cancel_edition();})
		.fail(function(){window.parent.$alert('ERROR. No se ha guardado la configuración.')});
	}
	function cancel_edition(){
		window.parent.$('#dynamicModalDialogIframe').attr('src','about:blank');
		window.parent.$("#dynamicModalDialog").dialog("close");
	}
	function isClear(){var input=$('input');return $(input[1]).val()==''||$(input[2]).val()==''||$(input[3]).val()==''}		
</script>
		
<style type="text/css">
	body{background:#778899;color:#000;font-family:Arial,Helvetica,sans-serif;font-size:10pt;}
	label{display:inline-block;width:80px;text-align:right;font-style:italic;}
	input{border:double #222 0.25em;background:#eee;margin:3px 0px;text-align:center;width:130px;}
	input:focus{border:double #0972a5 0.25em;}
	div.config-section .ui-button{font-size:0.9em;margin-top:20px;}
	span#warningMessage{color:#d00;display:none;}
</style>

</head>
<body>
<div class="config-section" align="center">
	<h4>Ingrese los datos de su visualizador</h4> 
	<label>Equipo : </label>
	<input type="text" id="viewerHostname" value="127.0.0.1" readonly="readonly"> <br>
	<label>Puerto : </label><input type="text"> <br>
	<label>AE Title : </label><input type="text"> <br>
	<label>Calling AET : </label><input type="text"> <br>
	<button type="button" id="saveConfiguration"></button> &nbsp;
	<button type="button" id="cancelChanges"></button> <br><br>
	<span id="warningMessage">complete todos los campos</span>
</div>
</body>
</html>