<html>
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
		<meta http-equiv="pragma" content="no-cache" />

		<script type="text/javascript" src="../js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="../js/jquery-ui.js"></script>
		<script type="text/javascript" src="../js/purl.js"></script>
		<script type="text/javascript" src="../js/css_browser_selector.js"></script>

		<link rel="stylesheet" type="text/css" href="../css/jquery-ui-1.10.4.css" />


<style type="text/css">

body {

	background: #bea;
}

#notDefinedInst {

	font-size: 0.9em;
}

.inst_names {

	float: left;
	padding-left: 10px;
}

.inst_buttons {

	float: right;
}

.inst_new {
	
	padding-top: 40px;
}

.btn {

	font-size: 0.8em;
}
.btnew {

	font-size: 0.8em;
}

input[type=text] {
	background-color: #fff;
	border: double #aaa 0.25em;
	border-radius: 5px;
	padding-left: 5px;
	text-align: center;
}

input[type=text]:focus {
	background-color: #fff;
	border: double #888 0.25em;
	border-radius: 5px;
	padding-left: 5px;
	text-align: center;
}

</style>

<script type="text/javascript">
	
	var div = null;
	
	$(document).ready(function() {
		
		div = $("#notDefinedInst");
		
		$.getJSON("../restricted/rest/abm/notdefinedinstitution")
		.done( function(data) {
			
			if(data && data.length>0) {
				
			$.each(data, function(index, inst) {
				
				div.append(getInstitution(inst));
				//div.append("<br><br>");
			});
			
			$('.btn').button({ icons: { primary: 'ui-icon-circle-plus' } })
			.on('click',function(){addInst(this);});
			$('.btnew').button({ icons: { primary: 'ui-icon-circle-check' } })
			.on('click', function(){createInst(this);});
			$('.inst_new').hide();
			}
			else div.append('no se encontraron instituciones');
		})
		.fail( function() {alert('error');} );
		
		
		
	});
	
	function getInstitution( name ) {
		
		var instName = 	"<div id='a_"+ name.replace(/ /g , '_spc_').replace(/\./g , '_dot_')
									+ "' class='inst_names'>" + name + "</div>" +
						
						"<div id='b_"+ name.replace(/ /g , '_spc_').replace(/\./g , '_dot_')
												+"' class='inst_buttons'>"+
						
						"<button id='btn_" + name.replace(/ /g , '_spc_').replace(/\./g , '_dot_')
											+ "' class='btn'>Agregar</button>	</div>" +
						
						"<div id='c_"+ name.replace(/ /g , '_spc_').replace(/\./g , '_dot_')
											+"' class='inst_new' align='center'>" +
						
						"Nombre de la institución:&nbsp; <input type='text' id='txt_"+ 
										name.replace(/ /g , '_spc_').replace(/\./g , '_dot_') + "' />" +
						
						"&nbsp;<button id='btn_"+ name.replace(/ /g , '_spc_').replace(/\./g , '_dot_')
										+"' class='btnew'>Crear</button>" +
						
						"</div><br class='"+ name.replace(/ /g , '_spc_').replace(/\./g , '_dot_') 
									+ "'><br class="+ name.replace(/ /g , '_spc_').replace(/\./g , '_dot_') +">";
					
		return instName;
	}
	
	function addInst(btn) {
		
		var subDiv = $('#c_' + btn.id.replace('btn_',''));
		var button = $(btn);
		
		if(!subDiv.is(':visible')) {
			subDiv.slideDown();
			button.button({ icons: { primary: 'ui-icon-circle-close' },
							label: 'Cancelar'}); 
		}
		else { 
			subDiv.slideUp();
			button.button({ icons: { primary: 'ui-icon-circle-plus' },
							label: 'Agregar'}); 
		}
	}
	
	function createInst(elem) {
		
		var dato = elem.id.replace('btn_', '');
		var ae = dato.replace(/_spc_/g, ' ').replace(/_dot_/g , '.');
		var nombre = $('#txt_'+dato).val();
		
		var dto = {
			nombre: nombre,
			ae: ae
		};
		
		$.ajax({
  	  		type: "POST",
  	  		url: '../restricted/rest/abm/newinstitution',
  	  		data: dto,
  	  		success: function() { alert('se ha creado la institución '+nombre);
  	  							  $('#a_' + dato).remove();
  	  							  $('#b_' + dato).remove();
  	  							  $('#c_' + dato).remove();
  	  							  $('.' + dato).remove(); },
			error: function() { alert('Ocurrió un error al momento de crear la institución'); }
  		});
	}

</script>

</head>

<body>

	<h5>La siguiente lista muestra las instituciones que aún no se han dado de alta.</h5>
		
	<br>	
		
	<div id="notDefinedInst"></div>

</body>

</html>